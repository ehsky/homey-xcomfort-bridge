<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>xComfort Bridge Settings</title>
    <script type="text/javascript" src="/homey.js" data-origin="settings"></script>
</head>
<body>
    <header class="homey-header">
        <h1 class="homey-title">xComfort Bridge Configuration</h1>
        <p class="homey-subtitle">Configure your xComfort Bridge connection settings</p>
    </header>

    <fieldset class="homey-form-fieldset">
        <legend class="homey-form-legend">Connection Settings</legend>

        <div class="homey-form-group">
            <label class="homey-form-label" for="bridge_ip">Bridge IP Address</label>
            <input class="homey-form-input" id="bridge_ip" type="text" placeholder="192.168.1.100" />
            <p class="homey-form-hint">The IP address of your xComfort Bridge on your local network</p>
        </div>

        <div class="homey-form-group">
            <label class="homey-form-label" for="auth_key">Authentication Key</label>
            <input class="homey-form-input" id="auth_key" type="password" placeholder="Enter your auth key" />
            <p class="homey-form-hint">The authentication key for your xComfort Bridge (found under bridge cover)</p>
        </div>
    </fieldset>

    <button id="save" class="homey-button-primary-full">Save Settings</button>

    <script type="text/javascript">
        function onHomeyReady(Homey) {
            // Tell Homey we're ready to be displayed
            Homey.ready();

            var bridgeIpElement = document.getElementById('bridge_ip');
            var authKeyElement = document.getElementById('auth_key');
            var saveElement = document.getElementById('save');

            // Load current settings
            Homey.get('bridge_ip', function(err, bridgeIp) {
                if (err) return Homey.alert(err);
                if (bridgeIp) bridgeIpElement.value = bridgeIp;
            });

            Homey.get('auth_key', function(err, authKey) {
                if (err) return Homey.alert(err);
                if (authKey) authKeyElement.value = authKey;
            });

            // Save button handler
            saveElement.addEventListener('click', function(e) {
                var bridgeIp = bridgeIpElement.value.trim();
                var authKey = authKeyElement.value.trim();

                if (!bridgeIp) {
                    return Homey.alert('Please enter a bridge IP address');
                }

                if (!authKey) {
                    return Homey.alert('Please enter an authentication key');
                }

                // Save bridge IP
                Homey.set('bridge_ip', bridgeIp, function(err) {
                    if (err) return Homey.alert('Error saving bridge IP: ' + err);

                    // Save auth key
                    Homey.set('auth_key', authKey, function(err) {
                        if (err) return Homey.alert('Error saving auth key: ' + err);

                        Homey.alert('Settings saved successfully!');
                    });
                });
            });
        }
    </script>
</body>
</html>